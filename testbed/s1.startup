ip link set eth0 address 00:00:00:00:00:01
ip link set eth1 address 00:00:00:00:00:02
chmod u+x ./retrieve_info.sh
chmod u+x ./startup.sh
chmod u+x ./change_key.sh
p4c-bm2-ss --emit-externs -o industrial_aes.json industrial_aes.p4
cd extern_lib && make
cd ..
echo '' > /shared/s1.log
simple_switch -i 1@eth0 -i 2@eth1 industrial_aes.json --log-console -- --load-modules=extern_lib/definition.so > /shared/s1.log 2>&1 &
#simple_switch -i 1@eth0 -i 2@eth1 industrial_aes.json --log-console -- --load-modules=extern_lib/definition.so &
while [[ $(pgrep simple_switch) -eq 0 ]]; do sleep 1; done
until simple_switch_CLI <<< "help"; do sleep 1; done

#simple_switch_CLI <<< $(cat commands.txt)
simple_switch_CLI <<< $(cat auto_test_commands.txt)
echo "s1 " >> /shared/startup.temp